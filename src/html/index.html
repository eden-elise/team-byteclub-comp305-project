<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BYTECLUB - Battle Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/battleScene.css">
</head>

<body>
    <main id="battle-screen" class="battle-container">
        <header id="battle-header" class="battle-header">
            <section class="combatant combatant--player" aria-label="Player Status">
                <h2 class="combatant__name" id="player-name">PLAYER</h2>
                <figure class="combatant__avatar">
                    <img id="player-sprite" src="" alt="Player" class="combatant__sprite">
                    <div id="player-target-indicator" class="target-indicator target-indicator--player">
                        <div class="target-indicator__line target-indicator__line--tl"></div>
                        <div class="target-indicator__line target-indicator__line--tr"></div>
                        <div class="target-indicator__line target-indicator__line--bl"></div>
                        <div class="target-indicator__line target-indicator__line--br"></div>
                    </div>
                </figure>
                <div class="combatant__stats">
                    <div class="stat-bar stat-bar--hp">
                        <label for="player-hp" class="stat-bar__label">
                            HP: <span id="player-hp-text">100</span>/<span id="player-hp-max">100</span>
                        </label>
                        <progress id="player-hp" class="stat-bar__progress" max="100" value="100"
                            aria-label="Player health points">
                        </progress>
                    </div>
                </div>
            </section>

            <div class="battle-divider" aria-hidden="true"></div>

            <section class="combatant combatant--enemy" aria-label="Enemy Status">
                <h2 class="combatant__name combatant__name--enemy" id="enemy-name">ENEMY</h2>
                <figure class="combatant__avatar">
                    <img id="enemy-sprite" src="" alt="Enemy" class="combatant__sprite">
                    <div id="enemy-target-indicator" class="target-indicator target-indicator--enemy">
                        <div class="target-indicator__line target-indicator__line--tl"></div>
                        <div class="target-indicator__line target-indicator__line--tr"></div>
                        <div class="target-indicator__line target-indicator__line--bl"></div>
                        <div class="target-indicator__line target-indicator__line--br"></div>
                    </div>
                </figure>
                <div class="combatant__stats">
                    <div class="stat-bar stat-bar--hp">
                        <label for="enemy-hp" class="stat-bar__label">
                            HP: <span id="enemy-hp-text">100</span>/<span id="enemy-hp-max">100</span>
                        </label>
                        <progress id="enemy-hp" class="stat-bar__progress" max="100" value="100"
                            aria-label="Enemy health points">
                        </progress>
                    </div>
                </div>
            </section>
        </header>

        <nav id="action-panel" class="action-panel" aria-label="Combat Actions">
            <div id="action-container" class="action-container">
                <!-- Action buttons or inventory will be shown here -->
            </div>
        </nav>

        <section id="combat-log" class="combat-log" aria-live="polite" aria-label="Combat Messages">
            <div class="combat-log__content" id="combat-log-content">
                <p class="combat-log__entry combat-log__entry--intro">Battle begins...</p>
            </div>
        </section>
    </main>

    <script type="module">
        // Import battle system classes
        import { BattleSequence } from '../gameplay/engine/BattleSequence.js';
        import { Entity } from '../gameplay/core/Entity.js';
        import { BattleSceneController } from './battleSceneController.js';

        /**
         * Demo: Create two hero entities and start battle
         */
        async function initDemo() {
            
            // Create demo inventory with item names and quantities
            const demoAttacks = [
                'Basic Strike',
                'Heavy Swing'
            ];
            const demoInventory = [
                { name: 'Health Potion', quantity: 5 },
                { name: 'Poison Potion', quantity: 2 },
                { name: 'Fire Potion', quantity: 3 },
                { name: 'Mystery Potion', quantity: 1 }
            ];
            // Create Hero 1 (using hero-1.png) - Knight
            const hero1 = new Entity(
                'Knight',
                100,
                {
                    ATK: 15,
                    DEF: 12,
                    SPD: 14
                },
                demoAttacks,
                demoInventory,
                '../../assets/art/characters/hero-1.png'
            );

            // Create Hero 2 (using hero-2.png) - Ranger
            const hero2 = new Entity(
                'Ranger',
                80,
                {
                    ATK: 18,
                    DEF: 8,
                    SPD: 16
                },
                demoAttacks,
                demoInventory,
                '../../assets/art/characters/hero-2.png'
            );


            // Create battle sequence
            const battleSequence = new BattleSequence(hero1, hero2);

            // Initialize the battle scene controller with inventory
            new BattleSceneController(battleSequence, hero1.items);
        }

        // Start the demo when page loads
        initDemo().catch(console.error);

        document.addEventListener('keydown', e => {
            if (e.key === 'r' || e.key === 'R') {
                // nuclear option
                localStorage.clear();
                sessionStorage.clear();

                initDemo().catch(console.error);
            }
        });
    </script>
</body>

</html>